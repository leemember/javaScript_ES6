<script src="../lib/fx.js"></script>

# ì´í„°ëŸ¬ë¸” ì¤‘ì‹¬ í”„ë¡œê·¸ë˜ë°ì—ì„œì˜ ì§€ì—° í‰ê°€ (Lazy Evaluation)
- ì œë•Œ ê³„ì‚°ë²•
- ëŠê¸‹í•œ ê³„ì‚°ë²•
- ì œë„ˆë ˆì´í„°/ì´í„°ë ˆì´í„° í”„ë¡œí† ì½œì„ ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„

### L.map

<script>
  L.map = function *(f, iter) {
    for (const a of iter) yield f(a);
  };

  //it í•¨ìˆ˜ì— ìˆëŠ” a=> a+10 ëŠ” L.mapì´ ì„ ì–¸í•œ ë§¤ê²Œë³€ìˆ˜ ì¤‘ fì— ì†í•œë‹¤.
  var it = L.map(a => a + 10, [1, 2, 3]);
  log(it.next());  // ê²°ê³¼ê°’ : {value: 1, don: false}
  log(it.next());  // ê²°ê³¼ê°’ : {value: 2, don: false}
  log(it.next());  // ê²°ê³¼ê°’ : {value: 3, don: false}
// L.mapì€ nextë¥¼ í†µí•´ì„œ ë‚´ê°€ í‰ê°€í•˜ëŠ” ë§Œí¼ì˜ ê°’ë§Œ ë°›ì„ ìˆ˜ ìˆë‹¤.
</script>

### L.filter

<!-- 
  ì´í„°ë ˆì´í„°ë¥¼ ëª¨ë‘ ìˆœíšŒí•˜ë©´ì„œ
  yieldí•˜ëŠ” ê°’ì´ L.filterì¸ ê²½ìš°ì—ëŠ” fë¥¼ ì ìš©í•´ ë´¤ì„ ë•Œ
  trueë¡œ ê°’ì´ ë–¨ì–´ì§„ë‹¤ë©´ ê·¸ë•Œ aë¥¼ yield í•´ì£¼ëŠ” ì‹ì´ë‹¤.
 -->
<script>
  L.filter = function *(f, iter) {
    for (const a of iter) if (f(a)) yield a;
    // ì›í•˜ëŠ” ìƒí™©ì—ë§Œ yieldí•´ì¤€ë‹¤. (í•„í„°ë§)
  };
  var it = L.filter(a => a % 2, [1, 2, 3, 4]);
  log(it.next()); // 1
  log(it.next()); // 3
  log(it.next()); // value : undefined

  //ì™œëƒë©´, ì¡°ê±´ì„ í™€ìˆ˜ë§Œ ë‚˜ì˜¤ê²Œë” í–ˆê¸° ë•Œë¬¸ì´ë‹¤.
</script>


### range, map, filter, take, reduce ì¤‘ì²© ì‚¬ìš©

<script>

  // range í•¨ìˆ˜ì˜ ê¸°ë³¸ê¼´ ì…ë‹ˆë‹¤.
  const range = l => {
    let i = -1;
    let res = [];
    while (++i < l) {
      res.push(i);
    }
    return res;
  };  
  // range í•¨ìˆ˜ -------------------

  const map = curry((f, iter) => {
    let res = [];  // ì¸ìê°€ ì–´ë–»ê²Œ ë“¤ì–´ê°€ëŠ”ì§€ í™•ì¸í•˜ê³ 
    iter = iter[Symbol.iterator]();
    let cur; // ì´í„°ë ˆì´í„°ê°€ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ í™•ì¸
    while (!(cur = iter.next()).done) { // ì–¸ì œê¹Œì§€ ë°˜ë³µí•˜ëŠ”ì§€ ì¡°ê±´
      const a = cur.value;
      res.push(f(a));
    }
    return res;
  });

  const filter = curry((f, iter) => {
    let res = []; // ì¸ìê°€ ì–´ë–»ê²Œ ë“¤ì–´ê°€ëŠ”ì§€ í™•ì¸í•˜ê³ 
    iter = iter[Symbol.iterator]();
    let cur; // ì´í„°ë ˆì´í„°ê°€ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ í™•ì¸
    while (!(cur = iter.next()).done) {
      const a = cur.value;
      if (f(a)) res.push(a); // aê°’ í™•ì¸í•˜ê¸°
    }
    return res;
  });

  const take = curry((l, iter) => {
    let res = [];
    iter = iter[Symbol.iterator]();
    let cur;
    while (!(cur = iter.next()).done) {
      const a = cur.value;
      res.push(a);
      if (res.length == l) return res; // ì–´ë–¨ ë•Œì— returnì„ í•˜ê²Œ ë˜ëŠ”ì§€.
    }
    return res;
  });

  const reduce = curry((f, acc, iter) => {
    if (!iter) {
      iter = acc[Symbol.iterator]();
      acc = iter.next().value;
    } else {
      iter = iter[Symbol.iterator]();
    }
    let cur;
    while (!(cur = iter.next()).done) {
      const a = cur.value;
      acc = f(acc, a);
    }
    return acc;
  });
//-----------------ë™ì¼í•œ ì½”ë“œì˜ Whileë¬¸ì„ ë„£ì–´ì¤¬ë‹¤---------------

  console.time('');
  go(range(100000),
    map(n => n + 10),
    filter(n => n % 2),
    take(10), // ê²°êµ­ take í•´ì£¼ëŠ” ìˆ˜ë§Œ ë½‘ì•„ë‚´ì¤€ë‹¤.
    log);
  console.timeEnd('');
  // ì›í•˜ëŠ” ê°’ë§Œ ë½‘ì•„ë‚´ê³  ëë‚´ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ìƒ ë¬¸ì œê°€ ì—†ë‹¤.
</script>

### L.range, L.map, L.filter, take, reduce ì¤‘ì²© ì‚¬ìš©

<script>
  L.range = function* (l) {
    let i = -1;
    while (++i < l) {
      yield i;
    }
  };

  L.map = curry(function* (f, iter) {
    iter = iter[Symbol.iterator]();
    let cur;
    while (!(cur = iter.next()).done) {
      const a = cur.value;
      yield f(a);
    }
  });

  L.filter = curry(function* (f, iter) {
    iter = iter[Symbol.iterator]();
    let cur;
    while (!(cur = iter.next()).done) {
      const a = cur.value;
      if (f(a)) {
        yield a;
      }
    }
  });

  // [0, 1, 2, 3, 4, 5, 6, 7, 8...]
  // [10, 11, 12, ...]
  // [11, 13, 15 ..]
  // [11, 13]
  //
  // [0    [1
  // 10     11
  // false]  true]
  // ì„¸ë¡œë¡œ ê³„ì‚°ë˜ê³  ìˆë‹¤.

  // console.time('L');
  //goí•¨ìˆ˜ëŠ” ë¶„ëª… ê³„ë‹¨ ë‚´ë ¤ê°€ëŠ” ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ëœë‹¤ê³  í–ˆìœ¼ë‚˜,
  go(L.range(Infinity), // ë¬´í•œìˆ˜ë¥¼ ë™ì‘ì‹œì¼œë„ 10ê°œë§Œ ë½‘ì•„ì¤€ë‹¤. take(10)ì´ë¼ì„œ
    L.map(n => n + 10),
    L.filter(n => n % 2),
    take(10), //ì´ê²Œ ê°€ì¥ ë¨¼ì € ì‹¤í–‰ëœë‹¤. ê·¸ë¦¬ê³  takeë¶€í„° ì—­ìœ¼ë¡œ L.filter - L.map ì´ ìˆœì„œëŒ€ë¡œ ê³„ì‚°ëœë‹¤. ê·¸ë¦¬ê³  ë˜ rangeë¡œ ë“¤ì–´ê°€ì„œ ê³„ë‹¨ ë‚´ë ¤ê°€ëŠ” ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ëœë‹¤.
    log);    
  // console.timeEnd('L');
</script>



## ê²°ê³¼ë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜ reduce, take

### reduce

<script>  
//í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì„ ì‚¬ìš©í•˜ë‹¤ë³´ë©´. 
// pipe í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ì½”ë“œì˜ ì¬ì‚¬ìš©ì„±ì˜ íš¨ìœ¨ì„ ëŠë‚„ ìˆ˜ ìˆë‹¤ê³  í•œë‹¤.
  L.entries = function* (obj) {
    for (const k in obj) yield [k, obj[k]];
  };

  const join = curry((sep = ',', iter) =>
    reduce((a, b) => `${a}${sep}${b}`, iter)); // ğŸ™Œì—¬ê¸°ì„œ ì´í„°ëŸ¬ë¸” í”„ë¡œí† ì½œì„ ì“´ë‹¤ëŠ” ì–˜ê¸°ëŠ”

  // ê°ì²´ë¡œë¶€í„° queryStrë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“ ë‹¤.
  const queryStr = pipe(
    L.entries, //entriesëŠ” key, valueë¥¼ êµ¬ë¶„í•´ì¤€ë‹¤.
    L.map(([k, v]) => `${k}=${v}`), //{limit: 10, offset: 10, type: 'notice'}ì´ëŸ° ê²°ê³¼ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.
    join('&')); // ğŸ™Œjoinìœ¼ë¡œ ê°ˆ ë•Œ ê¹Œì§€ ì§€ì—°í•œë‹¤ëŠ” ëœ»ì´ë‹¤.

  log(queryStr({limit: 10, offset: 10, type: 'notice'}));

  function *a() {
    yield 10;
    yield 11;
    yield 12;
    yield 13;
  }
  
  log(join(' - ', a())); // ê²°ê³¼ê°’ 10-11-12-13
  // joinì´ í•œ ë²ˆì— í•©ì³ì¤€ë‹¤.
</script>

### take, find

<script>
  const users = [
    {age: 32},
    {age: 31},
    {age: 37},
    {age: 28},
    {age: 25},
    {age: 32},
    {age: 31},
    {age: 37}
  ];

  const find = curry((f, iter) => go(
    iter,
    L.filter(f),
    take(1), // takeë¥¼ í†µí•´ ê²°ê³¼ë¥¼ í•˜ë‚˜ ì°¾ìœ¼ë©´ ê²°ê³¼ê°’ì„ ê·¸ë§Œ ë±‰ëŠ”ë‹¤.
    ([a]) => a));

  log(find(u => u.age < 30)(users)); // ìœ ì € ë‚˜ì´ê°€ 30ì‚´ ë³´ë‹¤ ì ì€.

  go(users,
    L.map(u => u.age),
    find(n => n < 30),
    log);
</script>