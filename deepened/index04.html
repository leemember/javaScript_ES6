<script src="../lib/fx.js"></script>

## L.flatten
// ê²°ê³¼ì ìœ¼ë¡œ ê°’ì„ ë‹¤ í¼ì³ì„œ í•˜ë‚˜ì˜ ë°°ì—´ë¡œ ë§Œë“œëŠ” í•¨ìˆ˜ì´ë‹¤.
// 
<script>
  log([...[1, 2], 3, 4, ...[5, 6], ...[7, 8, 9]]);

  const isIterable = a => a && a[Symbol.iterator];
  //&&ì„ í•´ì£¼ëŠ” ì´ìœ ëŠ” ì•ˆì „í•˜ê²Œ í•´ì£¼ëŠ” ì´ìœ ë¼ê³ í•¨

  L.flatten = function* (iter) {
    //ì´í„°ëŸ¬ë¸” í”„ë¡œí† ì½œì„ ì´ìš©í•œ ì§€ì—°ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œ ì œë„ˆë ˆì´í„°ë¡œ í•¨ìˆ˜ë¥¼ ì„ ì–¸í–ˆë‹¤.
    //L.flattenì˜ ê¸°ë³¸ í•¨ìˆ˜ì´ë‹¤.
    for (const a of iter) {
      if (isIterable(a)) for (const b of a) yield b
      // ì´í„°ëŸ¬ë¸”ì´ë©´ aë¥¼ í•˜ê³  ì•„ë‹ˆë©´ yieldë¥¼ í•˜ì (b)
      else yield a;
    }
  };

  var it = L.flatten([[1, 2], 3, 4, [5, 6], [7, 8, 9]]);
  //ì´ëŸ° ë°°ì—´ì´ ìˆë‹¤ê³  ë´¤ì„ë•Œ
  log(it.next());
  log(it.next()); // nextë¥¼ í•˜ë©´ ê°’ë“¤ì´ í•˜ë‚˜ì”© êº¼ë‚´ì§„ë‹¤.
  log(it.next());
  log(it.next());
  log(take(6, L.flatten([[1, 2], 3, 4, [5, 6], [7, 8, 9]])));
  // ìˆ˜ë™ì ìœ¼ë¡œ í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ í•œë²ˆì— ë™ì ìœ¼ë¡œ ê°’ë“¤ì„ í¼ì³ì£¼ê²Œ í•œë‹¤.

  // log(it.next());
  // log(it.next());
  // log(it.next());
  // log(it.next());
  
  //flattenëŠ” ê°’ë“¤ì„ ì¦‰ì‹œ í‰ê°€ë¥¼ í•´ì¤€ë‹¤.
  const flatten = pipe(L.flatten, takeAll);
  log(flatten([[1, 2], 3, 4, [5, 6], [7, 8, 9]]));

  console.clear();
</script>

## yield *

<script>
  L.flatten = function* (iter) {
    for (const a of iter) {
      if (isIterable(a)) ğŸ§¡ for (const b of a) yield b
      else yield a;
    }
  };
</script>

<script>
  L.flatten = function* (iter) {
    for (const a of iter) {
      if (isIterable(a)) ğŸ§¡ yield* a;
      else yield a;
    }
  };
</script>

ì´ë ‡ê²Œ yieldë¥¼ ì‚¬ìš©í•´ì„œ ë³€ê²½í•˜ì˜€ë‹¤.

## L.deepFlat

<script>
  L.deepFlat = function* f(iter) {
    for (const a of iter) {
      if (isIterable(a)) yield* f(a);
      else yield a;
    }
  };
  log([...L.deepFlat([1, [2, [3, 4], [[5]]]])]);
  // [1, 2, 3, 4, 5];
</script>

## L.flatMap
// ì´ í•¨ìˆ˜ëŠ” mapê³¼ flattenë¥¼ ë™ì‹œì— í•˜ëŠ” í•¨ìˆ˜ë¼ê³  ë³´ë©´ ëœë‹¤.
<script>
  log([[1, 2], [3, 4], [5, 6, 7]].flatMap(a => a));
  //ì´ê±¸ ì‹¤í–‰ í–ˆì„ ë•Œ ê²°ê³¼ê°’ì€ ì´ ê°’ë“¤ì„ ê·¸ëŒ€ë¡œ í¼ì³ì£¼ê²Œ ëœë‹¤. ë°°ì—´ë¡œ ì„ ì–¸ë˜ì§€ ì•Šì€ ê°’ë“¤ë„ í¼ì³ì¤Œ
  // flatMapë§Œì˜ íŠ¹ë³„í•œ ì ì€ (a => a)í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ì•ˆì— ìˆëŠ” ê°’ë“¤ì„ ë³€í™”ë¥¼ ì¤˜ì„œ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

  log([[1, 2], [3, 4], [5, 6, 7]].flatMap(a => a.map(a => a * a)));
  // ê³±í•œ ê°’ë“¤ì„ map í•¨ìˆ˜ë¥¼ í†µí•´ í•œêº¼ë²ˆì— ë½‘ì•„ë‚´ì¤€ë‹¤.

  L.flatMap = curry(pipe(L.map, L.flatten));
  const flatMap = curry(pipe(L.map, flatten));

  // var it = L.flatMap(map(a => a * a), [[1, 2], [3, 4], [5, 6, 7]]);
  var it = L.flatMap(a => a, [[1, 2], [3, 4], [5, 6, 7]]);
  log([...it]); // ì´ë ‡ê²Œ í•˜ë©´ ë°‘ì—ì²˜ëŸ¼ í•œë²ˆì”© next í•˜ì§€ ì•Šê³  ëª¨ë“  ê°’ì„ ë½‘ì•„ë‚´ì¤€ë‹¤.
  // log(it.next());
  // log(it.next());
  // log(it.next());
  // log(it.next());
  // log(it.next());
  // log(it.next());
  // log(it.next());
  log(flatMap(a => a, [[1, 2], [3, 4], [5, 6, 7]]));
  // ë°”ë¡œ ê°’ë“¤ë„ ì¦‰ì‹œí‰ê°€ í•´ì¤€ë‹¤.


  // ğŸ˜¬ ì‘ìš©í¸
  log(flatMap(L.range, map(a => a + 1, [1, 2, 3])));

  var it = L.flatMap(L.range, map(a => a + 1, [1, 2, 3]));
  log(it.next());
  log(it.next());
  log(it.next());
  log(it.next());

  log(take(3, L.flatMap(L.range, map(a => a + 1, [1, 2, 3]))));
  // ê²°ê³¼ê°’ : 0 1 0 1 0 2 0 1 2 3
  // ì´ í•¨ìˆ˜ëŠ” ì•ì— take 3ì´ ë˜ì–´ìˆìœ¼ë‹ˆ ê°’ì´ 3ê°œë§Œ ë½‘ì•„ì ¸ë‚˜ì˜¨ë‹¤.
  console.clear();
</script>


## 2ì°¨ì› ë°°ì—´ ë‹¤ë£¨ê¸°

<script>
  const arr = [
    [1, 2],
    [3, 4, 5],
    [6, 7, 8],
    [9, 10]
  ]; // ë°°ì—´ë¡œ ê°’ë“¤ì„ ë‹´ì•„ ë†“ëŠ”ë‹¤.
  // ê°’ì„ í‰ê°€ í•  ë•Œ, ìœ„ì—ì„œ ìˆœì„œëŒ€ë¡œ í‰ê°€í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼
  // 1 í•œë²ˆ í‰ê°€í•˜ê³  2 í•œë²ˆ í‰ê°€í•˜ê³  ì´ë ‡ê²Œ ì„¸ë¡œë¡œ í‰ê°€í•´ì¤€ë‹¤.

  go(arr, // ë°°ì—´ ê°’ë“¤ì„
    L.flatten, 
    L.filter(a => a % 2), // í•„í„°ë§ì„ í•´ì£¼ì–´ í™€ìˆ˜ë§Œ ë‚¨ê²¨ì¤€ë‹¤.
    L.map(a => a * a), // ë°˜ë³µë¬¸ìœ¼ë¡œ ê°’ì„ ë½‘ì•„ë‚´ì¤€ë‹¤.
    take(4), // 4ê°œê¹Œì§€ë§Œ ìˆœíšŒë¥¼ í•´ì¤€ë‹¤.
    reduce(add),
    log);
    // ë§Œì•½ Lì´ ì—†ë‹¤ë©´ ì§€ì—°ì„±ì´ ì—†ì–´ì„œ í•œ ë²ˆì— ì­ˆë£¨ë£© ê°’ì´ ë‹¤ ë‚˜ì˜¨ë‹¤.
</script>


## ì§€ì—°ì„± / ì´í„°ëŸ¬ë¸” ì¤‘ì‹¬ í”„ë¡œê·¸ë˜ë° ì‹¤ë¬´ì ì¸ ì½”ë“œ
<script>
  var users = [
    {
      name: 'a', age: 21, family: [
        {name: 'a1', age: 53}, {name: 'a2', age: 47},
        {name: 'a3', age: 16}, {name: 'a4', age: 15}
      ]
    },
    {
      name: 'b', age: 24, family: [
        {name: 'b1', age: 58}, {name: 'b2', age: 51},
        {name: 'b3', age: 19}, {name: 'b4', age: 22}
      ]
    },
    {
      name: 'c', age: 31, family: [
        {name: 'c1', age: 64}, {name: 'c2', age: 62}
      ]
    },
    {
      name: 'd', age: 20, family: [
        {name: 'd1', age: 42}, {name: 'd2', age: 42},
        {name: 'd3', age: 11}, {name: 'd4', age: 7}
      ]
    }
  ];
  // 4ëª…ì˜ ìœ ì €ë“¤ì˜ ê°’ì„ ì´ë ‡ê²Œ ë°°ì—´ë¡œ ë‹´ì•„ë‘ì—ˆë‹¤.

  go(users,
    L.flatMap(u => u.family), // mapì„ í†µí•´ ìœ ì €ì˜ íŒ¨ë°€ë¦¬ë¥¼ ë°˜ë³µë¬¸ìœ¼ë¡œ ë½‘ì•„ì¤€ë‹¤.
    L.filter(u => u.age > 20), // ê°€ì¡±ì¤‘ ì„±ì¸ì´ ì•„ë‹Œ ì‚¬ëŒë“¤ì„ ê±¸ëŸ¬ë‚´ì¤€ë‹¤.
    L.map(u => u.age), // ìœ ì €ë“¤ì˜ ë‚˜ì´ë¥¼ ë½‘ì•„ì¤€ë‹¤. ì´ë¦„ ë½‘ê³ ì‹¶ìœ¼ë©´ u.nameìœ¼ë¡œ í•˜ë©´ëœë‹¤.
    take(4), // 4ëª…ë§Œ ë½‘ì•„ì¤˜ë¼~~~
    reduce(add), // ì¶•ì•½í•´ì¤€ë‹¤.
    log);
</script>